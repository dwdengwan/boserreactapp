<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
    <script src="https://cdn.staticfile.org/echarts/4.7.0/echarts.js"></script>
    <style>
        html,body{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .chart_box{
            width: 100%;
            height: 100%;
            margin: 0 auto;
            -ms-overflow-style: none;
            overflow: -moz-scrollbars-none;
        }
        .chart_box::-webkit-scrollbar { width: 0 !important ;display:none;}
        #chinesechart::-webkit-scrollbar,
        #chinesechart canvas::-webkit-scrollbar,
        #chinesechart>div::-webkit-scrollbar { width: 0 !important ;display:none;}
        #chinesechart,
        #chinesechart>div,
        #chinesechart canvas
        { -ms-overflow-style: none;overflow: -moz-scrollbars-none;}
    </style>
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div class="chart_box">
    <div id="chinesechart"></div>
</div>
<script type="text/javascript">
    (function(){
        function getStyle(el, name) {
            if (window.getComputedStyle) {
                return window.getComputedStyle(el, null);
            } else {
                return el.currentStyle;
            }
        }
        //参数container为图表盒子节点.charts为图表节点
        function chartssize (container,charts) {
            function getStyle(el, name) {
                if (window.getComputedStyle) {
                    return window.getComputedStyle(el, null);
                } else {
                    return el.currentStyle;
                }
            }
            var wi = getStyle(container, 'width').width;
            var hi = getStyle(container, 'height').height;
            charts.style.width = wi
            charts.style.height = hi
        }
        let chartBox = document.getElementsByClassName('chart_box')[0];
        let myChartsize = document.getElementById('chinesechart');
        chartssize(chartBox,myChartsize)
        window.onresize=function(){
            let chartBox = document.getElementsByClassName('chart_box')[0];
            let myChartsize = document.getElementById('chinesechart');
            chartssize(chartBox,myChartsize)
        }
        //echart数据
        let echartData1 = [
            {
                name: '万科企业股份有限公司',
                value: 6,
                symbol:'rect',
                symbolSize: [180, 40],
                itemStyle: {
                    normal: {
                        label: {
                            show: false
                        },
                        disable:true,
                        borderWidth:0,
                    },
                },
                children: [
                    {
                        name: '分支机构',
                        value: 6,
                        symbol:'rect',
                        symbolSize: [120, 40],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                                lineStyle:{
                                    color:'rgba(100,0,100,0.2)',
                                }
                            },
                            borderWidth:0,
                        },
                        children: [
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '查看更多',
                                symbol:'rect',
                                symbolSize: [120, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                        ]
                    },
                    {
                        name: '对外投资',
                        symbol:'rect',
                        symbolSize: [120, 40],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                        value: 4,
                        children: [
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '查看更多',
                                symbol:'rect',
                                symbolSize: [120, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                        ]
                    },
                    {
                        name: '疑似控股',
                        symbol:'rect',
                        symbolSize: [120, 40],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                        value: 2,
                        children: [
                            {
                                name: '万科股份有限公司北海公司1',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司2',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司3',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '查看更多',
                                symbol:'rect',
                                symbolSize: [120, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                        ]
                    },
                ]
            }
        ]
        let echartData2 = JSON.parse(JSON.stringify(echartData1));
        //echart节点的样式
        let echartStyle = [
            {
                color:'rgba(100,200,50,0.2)',
                borderColor:'#e0f'
            },
            {
                color:'rgba(200,100,50,0.2)',
                borderColor:'#2ef'
            },
            {
                color:'rgba(50,100,200,0.2)',
                borderColor:'#fe9'
            },
        ];
        let echartItemStyle = function(fontColor,lineColor){
            return {
                itemStyle: {
                    normal: {
                        label: {
                            show: true,
                            position: 'inside',
                            textStyle: {
                                // : '#cc9999'
                                color:fontColor,
                                fontSize: 15,
                                fontWeight:  'bolder'
                            }
                        },
                        lineStyle: {
                            // '#000'
                            color:lineColor,
                            width: 1,
                            type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                        }
                    },
                    emphasis: {
                        label: {
                            show: true
                        }
                    }
                },
            }
        }
        //子节点的个数
        let childNum = 0;
        function changeEchartData(echartData){
            echartData[0].children.forEach((item,i)=>{
                item.itemStyle.color = echartStyle[i].color;
                item.itemStyle.borderColor = echartStyle[i].color;
                item.itemStyle.borderWidth = 0;
                // item.itemStyle.normal.lineStyle.color = echartStyle[i].borderColor;
                item.children.forEach((bitem)=>{
                    bitem.itemStyle.color = echartStyle[i].color;
                    bitem.itemStyle.borderColor = echartStyle[i].color;
                    bitem.itemStyle.borderWidth = 0;
                })
            })
        }
        changeEchartData(echartData1);
        changeEchartData(echartData2);
        // 基于准备好的dom，初始化echarts实例
        let myChart = echarts.init(document.getElementById('chinesechart'));
        //echart option设置
        let echartOption = {
            tooltip: {
                // show：'true',//默认：true；是否显示提示框组件，包括提示框浮层和 axisPointer。
                trigger: 'item',//默认：item；触发类型。item：数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。'axis'：坐标轴触发，主要在柱状图，折线图等会使用类目轴的图表中使用。'none':什么都不触发。
                triggerOn: 'mousemove',
                backgroundColor: "rgba(255,255,255,0.8)", //设置背景图片 rgba格式
                color: "#eee",
                borderWidth: "0", //边框宽度设置1
                borderColor: "gray", //设置边框颜色
                textStyle: {
                    color: "black" //设置文字颜色
                },
                showDelay: 0,//显示延时，添加显示延时可以避免频繁切换
                hideDelay: 50,//隐藏延时
                // transitionDuration: 10,//动画变换时长
                borderRadius: 8,//边框圆角
                padding: 10,    // [5, 10, 15, 20] 内边距
                // position: function (p) {
                //     // 位置回调
                //     // console.log && console.log(p);
                //     return [p[0] + 10, p[1] - 10];
                // },
                //下面是自定义悬浮框的部分，修改悬浮框的样式也是在这里，就是html的样式，自由发挥。
                formatter:function(params){
                    // console.log(params,params.data.name,params.data.value)
                    var res=
                    `
                       <div style="padding:20px;text-align: left">
                            <p style="color: #61e9ff;">${params.data.name}</p>
                            <p style="color: #61e9ff;"><span style="color: #999;">法定代表人: </span>&nbsp;&nbsp;&nbsp;易平安</p>
                            <p><span style="color: #999;">成立日期: </span>&nbsp;&nbsp;&nbsp;2008-06-13</p>
                            <p><span style="color: #999;">注册资本: </span>&nbsp;&nbsp;&nbsp;100,000万(元)</p>
                        </div>
                    `;
                    if (params.dataIndex == 1 ||
                        (params.data.name!== '查看更多'&&
                            params.data.name!== '收起' &&
                            params.data.name!== '对外投资'&&
                            params.data.name!== '分支机构' &&
                            params.data.name!== '疑似控股' )){
                        return res;
                    }
                }
            },
            series : [
                {
                    top:0,
                    left:'50%',
                    right:'10%',
                    bottom:0,
                    name:'左树图',
                    type:'tree',
                    // orient: 'horizontal',  // vertical horizontal
                    layout:'orthogonal',//radial orthogonal
                    orient: 'LR' ,
                    rootLocation: {x: '50%', y: '50%'}, // 根节点位置  {x: 'center',y: 10}
                    nodePadding: 50,
                    symbol: 'arrow',//arrow circle
                    symbolSize: 40,
                    edgeShape: 'polyline',
                    roam:true,
                    leaves:{

                    },
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                position: 'inside',
                                textStyle: {
                                    color:'#666',
                                    fontSize: 15,
                                    fontWeight:  'bolder'
                                }
                            },
                            lineStyle: {
                                color:'#eee',
                                width: 1,
                                type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                            }
                        },
                        emphasis: {
                            label: {
                                show: true
                            }
                        }
                    } ,
                    data: echartData1,
                    expandAndCollapse: true,
                    animationDuration: 550,
                    animationDurationUpdate: 750,
                },
                {
                    top:0,
                    left:'10%',
                    right:'50%',
                    bottom:0,
                    name:'右树图',
                    type:'tree',
                    // orient: 'vertical',  // vertical horizontal
                    layout:'orthogonal',//radial orthogonal
                    orient: 'RL',
                    rootLocation: {x: '50%', y: '50%'}, // 根节点位置  {x: 'center',y: 10}
                    nodePadding: 50,
                    symbol: 'arrow',//arrow circle
                    symbolSize: 40,
                    roam:true,
                    edgeShape: 'polyline',//curve  polyline
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                position: 'inside',
                                textStyle: {
                                    color:'#666',
                                    fontSize: 15,
                                    fontWeight:  'bolder'
                                }
                            },
                            lineStyle: {
                                color:'#eee',
                                width: 1,
                                type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                            }
                        },
                        emphasis: {
                            label: {
                                show: true
                            }
                        }
                    } ,
                    data: echartData2,
                    expandAndCollapse: true,
                    animationDuration: 550,
                    animationDurationUpdate: 750
                },
            ]
        };
        myChart.setOption(option = echartOption,true);
        //echart 节点点击事件
        myChart.on('click', clickFun); //也可以注册其他时间 hover 、mouseout等
        function clickFun(params) {
            console.log(params.seriesIndex,params.dataIndex);
            // echartResize()
            let index = params.dataIndex;
            let activeIndex = -1;
            let treeIndex = params.seriesIndex;
            //改变节点的样式
            let changeStyle = function (addData,activeIndex) {
                addData.forEach((item)=>{
                    item.itemStyle.color = echartStyle[activeIndex].color;
                    item.itemStyle.borderColor = echartStyle[activeIndex].color;
                    item.itemStyle.borderWidth = 0;
                })
            };
            echartOption.series.forEach((item)=>{
                // console.log(item.name);
            })
            if((index == 6 || index == 11 || index == 16 || index == 14 || index == 19 || index == 22) && params.data.name == '查看更多'){
                //查看更多
                if(index == 6){
                    activeIndex = 0;
                }else if(index == 11 || index == 14){
                    activeIndex = 1;
                }else if(index == 16 || index == 19 || index == 22){
                    activeIndex = 2;
                }
                let echartDataSelect = function (echartData) {
                    let child = echartData[0].children[activeIndex].children;
                    child.splice(child.length - 1,1);
                    let addData = [
                        {
                            name: '万科股份有限公司北海公司4',
                            symbol:'rect',
                            symbolSize: [220, 40],
                            value: 4,
                            itemStyle: {
                                normal: {
                                    label: {
                                        show: false
                                    },
                                },
                                borderWidth:0,
                            },
                        },
                        {
                            name: '万科股份有限公司北海公司5',
                            symbol:'rect',
                            symbolSize: [220, 40],
                            value: 4,
                            itemStyle: {
                                normal: {
                                    label: {
                                        show: false
                                    },
                                },
                                borderWidth:0,
                            },
                        },
                        {
                            name: '万科股份有限公司北海公司6',
                            symbol:'rect',
                            symbolSize: [220, 40],
                            value: 4,
                            itemStyle: {
                                normal: {
                                    label: {
                                        show: false
                                    },
                                },
                                borderWidth:0,
                            },
                        },
                        {
                            name: '收起',
                            symbol:'rect',
                            symbolSize: [120, 40],
                            value: 4,
                            itemStyle: {
                                normal: {
                                    label: {
                                        show: false
                                    },
                                },
                                borderWidth:0,
                            },
                        }
                    ];
                    changeStyle(addData,activeIndex);
                    child = child.concat(addData);
                    echartData[0].children[activeIndex].children = child;
                };
                if (treeIndex) {
                    echartDataSelect(echartData2)
                }else{
                    echartDataSelect(echartData1)
                }
                echartResize();
                myChart.setOption(option = echartOption,true);
                countChild(echartData1)
                countChild(echartData2)
            }else if((index == 9 || index == 14 || index == 17 || index == 19 || index == 22 || index == 25) && params.data.name == '收起'){
                //收起
                if(index == 9){
                    activeIndex = 0;
                }else if(index == 14 || index == 17){
                    activeIndex = 1;
                }else if(index == 19 || index == 22 || index == 25){
                    activeIndex = 2;
                }
                let echartDataSelect = function (echartData) {
                    let child = echartData[0].children[activeIndex].children;
                    child.splice(child.length - 4,4);
                    let addData = [
                        {
                            name: '查看更多',
                            symbol:'rect',
                            symbolSize: [120, 40],
                            value: 4,
                            itemStyle: {
                                normal: {
                                    label: {
                                        show: false
                                    },
                                },
                                borderWidth:0,
                            },
                        }
                    ];
                    changeStyle(addData,activeIndex)
                    child = child.concat(addData);
                    echartData[0].children[activeIndex].children = child;
                };
                if (treeIndex) {
                    echartDataSelect(echartData2)
                }else{
                    echartDataSelect(echartData1)
                }
                echartResize();
                myChart.setOption(option = echartOption,true);
                countChild(echartData1)
                countChild(echartData2)
            }else if(index == 1){
                // console.log('click 根节点')
                return
            }else{
                console.log('123aaa')
            }
            echartResize();
            countChild(echartData1)
            countChild(echartData2)
        }
        //计算树下有多少子节点
        function countChild(arr) {
            arr.forEach((item,i)=>{
                if (item.children !== undefined){
                    childNum += item.children.length;
                    countChild(item.children)
                }
                // console.log(childNum)
            })
        }
        countChild(echartData1);
        countChild(echartData2);
        //节点过多时 调节容器高度
        function echartResize (){
            let allNode=0;
            let nodes=myChart._chartsViews[0]._data._graphicEls;
            for(let i=0,count =nodes.length;i<count;i++){
                let node=nodes[i];
                if(node===undefined)
                continue;
                allNode++;
            }
            let height = window.innerHeight;
            let currentHeight = 50*allNode;
            let newWidth = Math.max(currentHeight,height);
            myChartsize.style.width = window.innerWidth + 'px';
            myChartsize.style.height = newWidth + 'px';
            myChart.resize();
            console.log('容器调整',myChartsize.style.width,myChartsize.style.height)
        }
        echartResize()
    })()
</script>
</body>
</html>