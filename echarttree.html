<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
    <script src="https://cdn.staticfile.org/echarts/4.7.0/echarts.js"></script>
    <style>
        html,body{
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .chart_box{
            width: 100%;
            height: 100%;
            margin: 0 auto;
            -ms-overflow-style: none;
            overflow: -moz-scrollbars-none;
        }
        .chart_box::-webkit-scrollbar { width: 0 !important ;display:none;}
        #chinesechart::-webkit-scrollbar,
        #chinesechart canvas::-webkit-scrollbar,
        #chinesechart>div::-webkit-scrollbar { width: 0 !important ;display:none;}
        #chinesechart,
        #chinesechart>div,
        #chinesechart canvas
        { -ms-overflow-style: none;overflow: -moz-scrollbars-none;}
    </style>
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div class="chart_box">
    <div id="chinesechart"></div>
</div>
<script type="text/javascript">
    (function(){
        function getStyle(el, name) {
        if (window.getComputedStyle) {
            return window.getComputedStyle(el, null);
        } else {
            return el.currentStyle;
        }
    }
        //参数container为图表盒子节点.charts为图表节点
        function chartssize (container,charts) {
            function getStyle(el, name) {
                if (window.getComputedStyle) {
                    return window.getComputedStyle(el, null);
                } else {
                    return el.currentStyle;
                }
            }
            var wi = getStyle(container, 'width').width;
            var hi = getStyle(container, 'height').height;
            charts.style.width = wi
            charts.style.height = hi
        }
        let chartBox = document.getElementsByClassName('chart_box')[0];
        let myChartsize = document.getElementById('chinesechart');
        chartssize(chartBox,myChartsize)
        window.onresize=function(){
            let chartBox = document.getElementsByClassName('chart_box')[0];
            let myChartsize = document.getElementById('chinesechart');
            chartssize(chartBox,myChartsize)
        }
        let echartData = [
            {
                name: '万科企业股份有限公司',
                value: 6,
                symbol:'rect',
                symbolSize: [180, 40],
                itemStyle: {
                    normal: {
                        label: {
                            show: false
                        },
                        disable:true,
                        borderWidth:0,
                    },
                },
                children: [
                    {
                        name: '分支机构',
                        value: 6,
                        symbol:'rect',
                        symbolSize: [120, 40],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                                lineStyle:{
                                    color:'rgba(100,0,100,0.2)',
                                }
                            },
                            borderWidth:0,
                        },
                        children: [
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '查看更多',
                                symbol:'rect',
                                symbolSize: [120, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                        ]
                    },
                    {
                        name: '对外投资',
                        symbol:'rect',
                        symbolSize: [120, 40],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                        value: 4,
                        children: [
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '收起',
                                symbol:'rect',
                                symbolSize: [120, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                        ]
                    },
                    {
                        name: '疑似控股',
                        symbol:'rect',
                        symbolSize: [120, 40],
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                        value: 2,
                        children: [
                            {
                                name: '万科股份有限公司北海公司1',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司2',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '万科股份有限公司北海公司3',
                                symbol:'rect',
                                symbolSize: [220, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                            {
                                name: '查看更多',
                                symbol:'rect',
                                symbolSize: [120, 40],
                                value: 4,
                                itemStyle: {
                                    normal: {
                                        label: {
                                            show: false
                                        },
                                    },
                                    borderWidth:0,
                                },
                            },
                        ]
                    },
                ]
            }
        ]
        let echartStyle = [
            {
                color:'rgba(100,200,50,0.2)',
                borderColor:'#e0f'
            },
            {
                color:'rgba(200,100,50,0.2)',
                borderColor:'#2ef'
            },
            {
                color:'rgba(50,100,200,0.2)',
                borderColor:'#fe9'
            },
        ];
        let echartItemStyle = function(fontColor,lineColor){
            return {
                itemStyle: {
                    normal: {
                        label: {
                            show: true,
                            position: 'inside',
                            textStyle: {
                                // : '#cc9999'
                                color:fontColor,
                                fontSize: 15,
                                fontWeight:  'bolder'
                            }
                        },
                        lineStyle: {
                            // '#000'
                            color:lineColor,
                            width: 1,
                            type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                        }
                    },
                    emphasis: {
                        label: {
                            show: true
                        }
                    }
                },
            }
        }
        echartData[0].children.forEach((item,i)=>{
            item.itemStyle.color = echartStyle[i].color; 
            item.itemStyle.borderColor = echartStyle[i].borderColor;   
            item.itemStyle.borderWidth = 0;  
            // item.itemStyle.normal.lineStyle.color = echartStyle[i].borderColor;
            item.children.forEach((bitem)=>{
                bitem.itemStyle.color = echartStyle[i].color; 
                bitem.itemStyle.borderColor = echartStyle[i].borderColor;   
                bitem.itemStyle.borderWidth = 0;
            })
        })
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('chinesechart'));
        let echartOption = {
            tooltip: {
                // show：'true',//默认：true；是否显示提示框组件，包括提示框浮层和 axisPointer。
                trigger: 'item',//默认：item；触发类型。item：数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。'axis'：坐标轴触发，主要在柱状图，折线图等会使用类目轴的图表中使用。'none':什么都不触发。
                triggerOn: 'mousemove',
                //下面是自定义悬浮框的部分，修改悬浮框的样式也是在这里，就是html的样式，自由发挥。
                // formatter:function(params){
                //     var res=
                //     "<p>名称:"+params[0].seriesName+
                //         "值:"+params[0].data.value+
                //         "时间:"+params[0].data.mDate+
                //     "</p>";
                //     console.log(res,params);
                //     return res;
                // }
            },

            // tooltip:{
            //     show:true,
            //     trigger:'axis',
            //     triggerOn: 'mousemove',
            //     axisPointer:{
            //         type:'shadow',
            //     },
            //     //下面是自定义悬浮框的部分，修改悬浮框的样式也是在这里，就是html的样式，自由发挥。
            //     formatter:function(params){
            //         var res=
            //         "<p>名称:"+params[0].seriesName+
            //             "值:"+params[0].data.value+
            //             "时间:"+params[0].data.mDate+
            //         "</p>";
            //         console.log(res,params);
            //         return res;
            //     }
            // },

            // tooltip: {
            //     show: true,
            //     trigger: 'axis',
            //     triggerOn: 'mousemove',
            //     //show: true,   //default true
            //     showDelay: 0,//显示延时，添加显示延时可以避免频繁切换
            //     hideDelay: 50,//隐藏延时
            //     transitionDuration: 0,//动画变换时长
            //     backgroundColor: 'rgba(0,0,0,0.7)',//背景颜色（此时为默认色）
            //     borderRadius: 8,//边框圆角
            //     padding: 10,    // [5, 10, 15, 20] 内边距
            //     position: function (p) {
            //         // 位置回调
            //         // console.log && console.log(p);
            //         return [p[0] + 10, p[1] - 10];
            //     },
            //     formatter: function (params, ticket, callback) {
            //         console.log(params)
            //         var res = "班级" + ' : ' + params[0].name + "班<br/>";
            //         for (var i = 0, l = params.length; i < l; i++) {
            //             res += '<br/>' + params[i].seriesName + ' : ' + params[i].value + "1111";//鼠标悬浮显示的字符串内容
            //         }
            //         setTimeout(function () {
            //             // 仅为了模拟异步回调
            //             callback(ticket, res);
            //         }, 1000)
            //         return 'loading...';
            //     }
            //     //formatter: "Template formatter: <br/>{b}<br/>{a}:{c}<br/>{a1}:{c1}"
            // },
            series : [
                {
                    top:0,
                    left:'50%',
                    right:'10%',
                    bottom:0,
                    name:'树图',
                    type:'tree',
                    // orient: 'horizontal',  // vertical horizontal
                    layout:'orthogonal',//radial orthogonal
                    orient: 'LR' ,
                    rootLocation: {x: '50%', y: '50%'}, // 根节点位置  {x: 'center',y: 10}
                    nodePadding: 50,
                    symbol: 'circle',
                    symbolSize: 40,
                    edgeShape: 'polyline',
                    roam:true,
                    leaves:{

                    },
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                position: 'inside',
                                textStyle: {
                                    color:'#666',
                                    fontSize: 15,
                                    fontWeight:  'bolder'
                                }
                            },
                            lineStyle: {
                                color:'#eee',
                                width: 1,
                                type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                            }
                        },
                        emphasis: {
                            label: {
                                show: true
                            }
                        }
                    } ,
                    data: echartData,
                    expandAndCollapse: true,
                    animationDuration: 550,
                    animationDurationUpdate: 750,
                },
                {
                    top:0,
                    left:'10%',
                    right:'50%',
                    bottom:0,
                    name:'树图',
                    type:'tree',
                    // orient: 'vertical',  // vertical horizontal
                    layout:'orthogonal',//radial orthogonal
                    orient: 'RL',
                    rootLocation: {x: '50%', y: '50%'}, // 根节点位置  {x: 'center',y: 10}
                    nodePadding: 50,
                    symbol: 'circle',
                    symbolSize: 40,
                    roam:true,
                    edgeShape: 'polyline',//curve  polyline
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                position: 'inside',
                                textStyle: {
                                    color:'#666',
                                    fontSize: 15,
                                    fontWeight:  'bolder'
                                }
                            },
                            lineStyle: {
                                color:'#eee',
                                width: 1,
                                type: 'solid' // 'curve'|'broken'|'solid'|'dotted'|'dashed'
                            }
                        },
                        emphasis: {
                            label: {
                                show: true
                            }
                        }
                    } ,
                    data: echartData,
                    expandAndCollapse: true,
                    animationDuration: 550,
                    animationDurationUpdate: 750
                },
            ]
        };
        myChart.setOption(option = echartOption,true);
        myChart.on('click', clickFun); //也可以注册其他时间 hover 、mouseout等
        function clickFun(params) {
            console.log(params.dataIndex,params);
            echartResize()
            if(params.dataIndex == 19){
                console.log('dyk kyd');
                let child = echartData[0].children[2].children;
                child.splice(child.length - 1,1);
                let addData = [
                    {
                        name: '万科股份有限公司北海公司4',
                        symbol:'rect',
                        symbolSize: [220, 40],
                        value: 4,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                    },
                    {
                        name: '万科股份有限公司北海公司5',
                        symbol:'rect',
                        symbolSize: [220, 40],
                        value: 4,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                    },
                    {
                        name: '万科股份有限公司北海公司6',
                        symbol:'rect',
                        symbolSize: [220, 40],
                        value: 4,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                    },
                    {
                        name: '收起',
                        symbol:'rect',
                        symbolSize: [120, 40],
                        value: 4,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                    }
                ];
                child = child.concat(addData);
                echartData[0].children[2].children = child;
                // echartResize();
                myChart.setOption(option = echartOption,true);
                console.log(echartData,child);
            }else if(params.dataIndex == 22){
                console.log('dw wd');
                let child = echartData[0].children[2].children;
                child.splice(child.length - 4,4);
                let addData = [
                    {
                        name: '查看更多',
                        symbol:'rect',
                        symbolSize: [120, 40],
                        value: 4,
                        itemStyle: {
                            normal: {
                                label: {
                                    show: false
                                },
                            },
                            borderWidth:0,
                        },
                    }
                ];
                child = child.concat(addData);
                echartData[0].children[2].children = child;
                // echartResize();
                myChart.setOption(option = echartOption,true);
                console.log(echartData,child);
            }else if(params.dataIndex == 1){
                console.log('click 根节点')
                return    
            }
        }
        //计算树下有多少子节点
        let num = 0;
        function countChild(arr) {
            arr.forEach((item,i)=>{
                if (item.children !== undefined){
                    num += item.children.length;
                    countChild(item.children)
                }
            })
        }
        countChild(echartData);
        //节点过多时 调节容器高度
        function echartResize (){
            let allNode=0;
            let nodes=myChart._chartsViews[0]._data._graphicEls;
            for(let i=0,count =nodes.length;i<count;i++){
                let node=nodes[i];
                if(node===undefined)
                continue;
                allNode++;
            }
            let height = window.innerHeight;
            let currentHeight = 50*allNode;
            let newWidth = Math.max(currentHeight,height);
            myChartsize.style.width = window.innerWidth + 'px';
            myChartsize.style.height = newWidth + 'px';
            myChart.resize();
        }
        echartResize()
    })()
</script>
</body>
</html>